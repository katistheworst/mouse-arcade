<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mouse Cipher â€” The Ancient Language of the Floorboard Council</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #0a0014;
    color: #e8d5ff;
    font-family: 'Courier New', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  #starfield {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
  }

  .container {
    position: relative; z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
  }

  header {
    text-align: center;
    padding: 30px 0 10px;
  }

  .title-emoji { font-size: 2.5rem; display: block; margin-bottom: 10px; }

  h1 {
    font-size: clamp(1.4rem, 4vw, 2rem);
    color: #c084fc;
    text-shadow: 0 0 20px #a855f7;
    letter-spacing: 2px;
    margin-bottom: 6px;
  }

  .subtitle {
    font-size: 0.75rem;
    color: #7c3aed;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 20px;
  }

  .lore {
    background: rgba(88, 28, 135, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 10px;
    padding: 14px 18px;
    font-size: 0.78rem;
    color: #c4b5fd;
    line-height: 1.7;
    margin-bottom: 24px;
    font-style: italic;
  }

  .lore strong { color: #e879f9; font-style: normal; }

  /* Mode toggle */
  .mode-toggle {
    display: flex;
    gap: 0;
    margin: 0 auto 24px;
    max-width: 400px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(139, 92, 246, 0.4);
  }

  .mode-btn {
    flex: 1;
    padding: 12px;
    background: rgba(88, 28, 135, 0.2);
    border: none;
    color: #a78bfa;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 1px;
  }

  .mode-btn.active {
    background: rgba(139, 92, 246, 0.5);
    color: #fff;
    text-shadow: 0 0 10px #c084fc;
  }

  .mode-btn:hover:not(.active) { background: rgba(88, 28, 135, 0.4); }

  /* Panels */
  .panel {
    background: rgba(15, 0, 30, 0.7);
    border: 1px solid rgba(139, 92, 246, 0.35);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .panel-label {
    font-size: 0.7rem;
    color: #7c3aed;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  textarea {
    width: 100%;
    background: rgba(88, 28, 135, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 8px;
    color: #e8d5ff;
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    padding: 14px;
    resize: vertical;
    min-height: 90px;
    outline: none;
    transition: border-color 0.2s;
    line-height: 1.6;
  }

  textarea:focus { border-color: #a855f7; }

  textarea::placeholder { color: rgba(139, 92, 246, 0.4); }

  .output-box {
    background: rgba(88, 28, 135, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 8px;
    padding: 14px;
    min-height: 90px;
    font-size: 0.95rem;
    line-height: 1.8;
    color: #e8d5ff;
    word-break: break-all;
    position: relative;
  }

  .output-box.has-content { color: #d8b4fe; }

  .output-placeholder { color: rgba(139, 92, 246, 0.4); font-style: italic; }

  /* Squeaks render as pretty colored spans */
  .squeak-word { 
    display: inline-block;
    margin: 0 1px;
  }
  .squeak-syllable {
    color: #e879f9;
    font-weight: bold;
  }
  .squeak-sep {
    color: rgba(139, 92, 246, 0.5);
  }
  .word-sep {
    color: rgba(139, 92, 246, 0.3);
    padding: 0 4px;
    font-size: 0.8rem;
  }

  /* Buttons row */
  .btn-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 12px;
  }

  .btn {
    padding: 9px 18px;
    border-radius: 8px;
    border: 1px solid rgba(139, 92, 246, 0.5);
    background: rgba(88, 28, 135, 0.3);
    color: #c084fc;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 1px;
  }

  .btn:hover { background: rgba(139, 92, 246, 0.4); color: #fff; }
  .btn.primary { background: rgba(139, 92, 246, 0.4); color: #fff; border-color: #a855f7; }
  .btn.primary:hover { background: rgba(168, 85, 247, 0.6); }
  .btn.copied { background: rgba(34, 197, 94, 0.3); border-color: #22c55e; color: #4ade80; }

  /* Cipher Wheel */
  .wheel-section {
    margin-bottom: 20px;
  }

  .wheel-toggle {
    width: 100%;
    padding: 12px;
    background: rgba(88, 28, 135, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 10px;
    color: #a78bfa;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s;
    letter-spacing: 1px;
  }

  .wheel-toggle:hover { background: rgba(88, 28, 135, 0.4); }

  .cipher-wheel {
    display: none;
    background: rgba(15, 0, 30, 0.7);
    border: 1px solid rgba(139, 92, 246, 0.35);
    border-radius: 12px;
    padding: 20px;
    margin-top: 10px;
  }

  .cipher-wheel.visible { display: block; }

  .wheel-title {
    font-size: 0.7rem;
    color: #7c3aed;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 14px;
    text-align: center;
  }

  .wheel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 6px;
  }

  .wheel-entry {
    background: rgba(88, 28, 135, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.2);
    border-radius: 6px;
    padding: 7px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.78rem;
  }

  .wheel-letter {
    color: #c084fc;
    font-weight: bold;
    font-size: 0.9rem;
  }

  .wheel-squeak {
    color: #e879f9;
    font-size: 0.72rem;
    letter-spacing: 0.5px;
  }

  /* Special chars section */
  .specials {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(139, 92, 246, 0.2);
  }

  .specials-label {
    font-size: 0.65rem;
    color: #7c3aed;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .specials-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  /* Fun stats */
  .stats-bar {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    background: rgba(88, 28, 135, 0.15);
    border-radius: 8px;
    padding: 10px 14px;
    margin-top: 12px;
    font-size: 0.75rem;
    color: #7c3aed;
  }

  .stat-item strong { color: #c084fc; }

  /* Audio wave */
  #waveCanvas {
    width: 100%;
    height: 50px;
    display: block;
    border-radius: 8px;
    background: rgba(88, 28, 135, 0.1);
    margin-top: 10px;
  }

  /* Animate key in output */
  @keyframes squeak-in {
    from { opacity: 0; transform: scale(0.8) translateY(-4px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .squeak-char {
    display: inline-block;
    animation: squeak-in 0.15s ease forwards;
  }

  /* Playback button */
  .playback-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
  }

  .play-btn {
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px solid rgba(233, 121, 249, 0.5);
    background: rgba(233, 121, 249, 0.15);
    color: #e879f9;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .play-btn:hover { background: rgba(233, 121, 249, 0.3); }
  .play-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .play-status {
    font-size: 0.72rem;
    color: #7c3aed;
    font-style: italic;
  }

  footer {
    text-align: center;
    padding: 30px 0;
    font-size: 0.7rem;
    color: rgba(124, 58, 237, 0.5);
    letter-spacing: 1px;
  }
</style>
</head>
<body>

<canvas id="starfield"></canvas>

<div class="container">
  <header>
    <span class="title-emoji">ğŸ­</span>
    <h1>THE MOUSE CIPHER</h1>
    <div class="subtitle">â˜… Ancient Language of the Floorboard Council â˜…</div>
  </header>

  <div class="lore">
    Long before the Great Cat Incident, the mice of the Floorboard Council developed 
    a <strong>secret language</strong> â€” a series of precise squeaks, chittering, and eeking 
    patterns that could only be decoded by those who knew the key.<br><br>
    Each letter maps to a unique mouse syllable. Human ears hear noise.
    Mouse ears hear <strong>everything</strong>. 
    Now you can speak it too.
  </div>

  <!-- Mode toggle -->
  <div class="mode-toggle">
    <button class="mode-btn active" id="encodeBtn" onclick="setMode('encode')">
      ğŸ”’ ENCODE (Human â†’ Mouse)
    </button>
    <button class="mode-btn" id="decodeBtn" onclick="setMode('decode')">
      ğŸ”“ DECODE (Mouse â†’ Human)
    </button>
  </div>

  <!-- Encode panel -->
  <div id="encodePanel">
    <div class="panel">
      <div class="panel-label">âœï¸ your message (human language)</div>
      <textarea id="humanInput" placeholder="type anything... it will be translated into mouse language"
        oninput="encodeText()" maxlength="500"></textarea>
      <div class="btn-row">
        <button class="btn" onclick="clearEncode()">âœ• clear</button>
        <button class="btn" onclick="loadSample()">ğŸ“œ sample message</button>
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">ğŸ­ mouse translation</div>
      <div class="output-box" id="encodedOutput">
        <span class="output-placeholder">mouse squeaks will appear here...</span>
      </div>
      <div class="stats-bar" id="encodeStats" style="display:none">
        <span class="stat-item">chars: <strong id="charCount">0</strong></span>
        <span class="stat-item">squeaks: <strong id="squeakCount">0</strong></span>
        <span class="stat-item">words: <strong id="wordCount">0</strong></span>
        <span class="stat-item">loudness: <strong id="loudness">â€”</strong></span>
      </div>
      <div class="playback-row">
        <button class="play-btn" id="playBtn" onclick="playSqueak()" disabled>â–¶ play squeak</button>
        <canvas id="waveCanvas" width="400" height="50"></canvas>
      </div>
      <div class="btn-row">
        <button class="btn primary" id="copyEncodeBtn" onclick="copyEncoded()">ğŸ“‹ copy mouse language</button>
        <button class="btn" onclick="copyRaw()">copy raw text</button>
      </div>
    </div>
  </div>

  <!-- Decode panel -->
  <div id="decodePanel" style="display:none">
    <div class="panel">
      <div class="panel-label">ğŸ­ mouse language input</div>
      <textarea id="mouseInput" placeholder="paste mouse language here (eek-squee-chit / ook-meek-rit / ...)"
        oninput="decodeText()" style="color: #e879f9;"></textarea>
      <div class="btn-row">
        <button class="btn" onclick="clearDecode()">âœ• clear</button>
        <button class="btn" onclick="loadMouseSample()">ğŸ§€ sample mouse message</button>
      </div>
    </div>

    <div class="panel">
      <div class="panel-label">ğŸ’¬ decoded message</div>
      <div class="output-box" id="decodedOutput">
        <span class="output-placeholder">human translation will appear here...</span>
      </div>
      <div id="decodeWarning" style="display:none; font-size:0.72rem; color:#f97316; margin-top:8px;">
        âš ï¸ some syllables couldn't be decoded â€” unknown mouse dialect?
      </div>
      <div class="btn-row">
        <button class="btn primary" onclick="copyDecoded()">ğŸ“‹ copy decoded message</button>
      </div>
    </div>
  </div>

  <!-- Cipher Wheel -->
  <div class="wheel-section">
    <button class="wheel-toggle" onclick="toggleWheel()">
      ğŸ”‘ view cipher wheel (the key) â–¾
    </button>
    <div class="cipher-wheel" id="cipherWheel">
      <div class="wheel-title">â€” the floorboard cipher key â€”</div>
      <div class="wheel-grid" id="wheelGrid"></div>
      <div class="specials">
        <div class="specials-label">special characters</div>
        <div class="specials-grid" id="specialsGrid"></div>
      </div>
    </div>
  </div>

  <footer>
    ğŸ­ Â· the ancient language endures Â· ğŸ§€<br><br>
    mouse cipher v1.0 â€” built from floorboard council archives
  </footer>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THE CIPHER MAP â€” 26 letters, each a unique mouse sound
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CIPHER = {
  'a': 'eek',
  'b': 'bik',
  'c': 'chit',
  'd': 'deet',
  'e': 'meek',
  'f': 'fwee',
  'g': 'grit',
  'h': 'hik',
  'i': 'ik',
  'j': 'jeet',
  'k': 'krit',
  'l': 'lyuu',
  'm': 'mik',
  'n': 'nik',
  'o': 'ook',
  'p': 'pit',
  'q': 'qwee',
  'r': 'rit',
  's': 'sss',
  't': 'tik',
  'u': 'uk',
  'v': 'vit',
  'w': 'wik',
  'x': 'xit',
  'y': 'yee',
  'z': 'zik',
  '0': 'nul',
  '1': 'wun',
  '2': 'tuu',
  '3': 'tri',
  '4': 'for',
  '5': 'fiv',
  '6': 'sik',
  '7': 'sev',
  '8': 'ayt',
  '9': 'nin',
  '.': 'Â·',
  ',': 'Â·Â·',
  '!': '!ik',
  '?': '?ik',
  ' ': null, // word separator
};

// Build reverse map
const REVERSE_CIPHER = {};
for (const [human, mouse] of Object.entries(CIPHER)) {
  if (mouse && mouse !== null) {
    REVERSE_CIPHER[mouse.toLowerCase()] = human;
  }
}

const WORD_SEP = ' / '; // separator between words
const SYL_SEP = '-';    // separator between syllables within a word

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENCODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function encodeText() {
  const input = document.getElementById('humanInput').value;
  const outputEl = document.getElementById('encodedOutput');

  if (!input.trim()) {
    outputEl.innerHTML = '<span class="output-placeholder">mouse squeaks will appear here...</span>';
    document.getElementById('encodeStats').style.display = 'none';
    document.getElementById('playBtn').disabled = true;
    document.getElementById('playBtn').dataset.encoded = '';
    drawIdleWave();
    return;
  }

  // Split into words
  const words = input.split(' ');
  let html = '';
  let totalSqueaks = 0;
  let plainText = '';

  words.forEach((word, wi) => {
    if (!word) {
      if (wi < words.length - 1) html += '<span class="word-sep">/</span> ';
      return;
    }

    // Encode each char in the word
    const syllables = [];
    for (const ch of word.toLowerCase()) {
      if (CIPHER.hasOwnProperty(ch) && CIPHER[ch] !== null) {
        syllables.push(CIPHER[ch]);
        totalSqueaks++;
      } else if (ch !== ' ') {
        syllables.push('~'); // unknown
        totalSqueaks++;
      }
    }

    const wordStr = syllables.join(SYL_SEP);
    html += `<span class="squeak-word"><span class="squeak-syllable">${wordStr}</span></span>`;
    if (wi < words.length - 1) html += '<span class="word-sep"> / </span>';

    if (wi > 0) plainText += ' / ';
    plainText += wordStr;
  });

  outputEl.innerHTML = html;
  outputEl.className = 'output-box has-content';

  // Stats
  const charCount = input.replace(/ /g,'').length;
  const wordCount = words.filter(w => w.trim()).length;
  const loudness = input.includes('!') ? 'LOUD' : 
                   input.match(/[A-Z]/) ? 'bold' : 
                   charCount < 10 ? 'whisper' : charCount < 40 ? 'normal' : 'chatter';

  document.getElementById('charCount').textContent = charCount;
  document.getElementById('squeakCount').textContent = totalSqueaks;
  document.getElementById('wordCount').textContent = wordCount;
  document.getElementById('loudness').textContent = loudness;
  document.getElementById('encodeStats').style.display = 'flex';

  // Store for copy/play
  document.getElementById('playBtn').dataset.encoded = plainText;
  document.getElementById('playBtn').disabled = false;
  drawLiveWave(totalSqueaks);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DECODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function decodeText() {
  const input = document.getElementById('mouseInput').value.trim();
  const outputEl = document.getElementById('decodedOutput');
  const warning = document.getElementById('decodeWarning');

  if (!input) {
    outputEl.innerHTML = '<span class="output-placeholder">human translation will appear here...</span>';
    warning.style.display = 'none';
    return;
  }

  let hasUnknown = false;
  // Words are separated by ' / ' or '/'
  const wordTokens = input.split(/\s*\/\s*/);
  const decodedWords = [];

  for (const wordToken of wordTokens) {
    if (!wordToken.trim()) { decodedWords.push(' '); continue; }
    // Syllables separated by '-' or 'Â·'
    const syllables = wordToken.trim().split(/[-Â·]+/);
    let wordResult = '';
    for (const syl of syllables) {
      const s = syl.trim().toLowerCase();
      if (!s) continue;
      if (REVERSE_CIPHER.hasOwnProperty(s)) {
        wordResult += REVERSE_CIPHER[s];
      } else {
        wordResult += '?';
        hasUnknown = true;
      }
    }
    decodedWords.push(wordResult);
  }

  const decoded = decodedWords.join(' ').trim();
  outputEl.innerHTML = `<span style="color:#d8b4fe; font-size:1.05rem; letter-spacing:1px;">${escHtml(decoded)}</span>`;
  outputEl.className = 'output-box has-content';
  warning.style.display = hasUnknown ? 'block' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO â€” synthesize mouse squeaks using Web Audio
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let audioCtx = null;
let isPlaying = false;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playSqueak() {
  if (isPlaying) return;
  const encoded = document.getElementById('playBtn').dataset.encoded;
  if (!encoded) return;

  const ctx = getAudioCtx();
  isPlaying = true;
  document.getElementById('playBtn').disabled = true;
  document.getElementById('playBtn').textContent = 'â–â– playing...';
  document.getElementById('playStatus') && (document.getElementById('playStatus').textContent = 'speaking mouse...');

  // Parse words and syllables for timing
  const words = encoded.split(' / ');
  let time = ctx.currentTime + 0.05;

  for (const word of words) {
    const syllables = word.split('-');
    for (const syl of syllables) {
      playMouseSyllable(ctx, syl.trim(), time);
      time += 0.13;
    }
    time += 0.08; // pause between words
  }

  // Re-enable when done
  setTimeout(() => {
    isPlaying = false;
    document.getElementById('playBtn').disabled = false;
    document.getElementById('playBtn').textContent = 'â–¶ play squeak';
  }, (time - ctx.currentTime + 0.2) * 1000);
}

function playMouseSyllable(ctx, syl, when) {
  const duration = 0.1;

  // Base frequency varies by syllable
  const freqMap = {
    'eek': 1800, 'bik': 1200, 'chit': 2200, 'deet': 1600, 'meek': 1900,
    'fwee': 2000, 'grit': 1100, 'hik': 1700, 'ik': 2400, 'jeet': 1500,
    'krit': 1300, 'lyuu': 1400, 'mik': 1800, 'nik': 2100, 'ook': 800,
    'pit': 1600, 'qwee': 2000, 'rit': 1500, 'sss': 3500, 'tik': 2300,
    'uk': 900, 'vit': 1700, 'wik': 1400, 'xit': 2200, 'yee': 2000, 'zik': 2400,
  };

  const freq = freqMap[syl] || 1800;

  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = 'sine';
  osc.frequency.setValueAtTime(freq, when);
  osc.frequency.exponentialRampToValueAtTime(freq * 1.3, when + duration * 0.3);
  osc.frequency.exponentialRampToValueAtTime(freq * 0.8, when + duration);

  gain.gain.setValueAtTime(0, when);
  gain.gain.linearRampToValueAtTime(0.12, when + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.001, when + duration);

  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start(when);
  osc.stop(when + duration + 0.01);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WAVE CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawIdleWave() {
  const canvas = document.getElementById('waveCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = 'rgba(139, 92, 246, 0.2)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  const mid = canvas.height / 2;
  ctx.moveTo(0, mid);
  ctx.lineTo(canvas.width, mid);
  ctx.stroke();
}

function drawLiveWave(energy) {
  const canvas = document.getElementById('waveCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const mid = canvas.height / 2;
  const amp = Math.min(20, 3 + energy * 0.8);

  ctx.strokeStyle = 'rgba(233, 121, 249, 0.8)';
  ctx.lineWidth = 2;
  ctx.shadowColor = '#e879f9';
  ctx.shadowBlur = 8;
  ctx.beginPath();

  for (let x = 0; x <= canvas.width; x++) {
    const y = mid + Math.sin(x * 0.08 + energy) * amp 
                  + Math.sin(x * 0.13 + energy * 0.5) * amp * 0.5;
    if (x === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIPHER WHEEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildWheel() {
  const grid = document.getElementById('wheelGrid');
  const specials = document.getElementById('specialsGrid');

  const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
  const nums = '0123456789'.split('');
  const punctuation = ['.', ',', '!', '?'];

  for (const l of letters) {
    const div = document.createElement('div');
    div.className = 'wheel-entry';
    div.innerHTML = `<span class="wheel-letter">${l.toUpperCase()}</span><span class="wheel-squeak">${CIPHER[l]}</span>`;
    grid.appendChild(div);
  }

  for (const n of nums) {
    const div = document.createElement('div');
    div.className = 'wheel-entry';
    div.innerHTML = `<span class="wheel-letter" style="color:#a78bfa">${n}</span><span class="wheel-squeak">${CIPHER[n]}</span>`;
    grid.appendChild(div);
  }

  for (const p of punctuation) {
    const div = document.createElement('div');
    div.className = 'wheel-entry';
    div.style.minWidth = '100px';
    div.innerHTML = `<span class="wheel-letter" style="color:#f472b6">${p}</span><span class="wheel-squeak">${CIPHER[p]}</span>`;
    specials.appendChild(div);
  }

  const sepDiv = document.createElement('div');
  sepDiv.className = 'wheel-entry';
  sepDiv.style.minWidth = '150px';
  sepDiv.innerHTML = `<span class="wheel-letter" style="color:#f472b6">SPACE</span><span class="wheel-squeak"> / (word break)</span>`;
  specials.appendChild(sepDiv);
}

function toggleWheel() {
  const wheel = document.getElementById('cipherWheel');
  wheel.classList.toggle('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAMPLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SAMPLES = [
  "the cheese is mine",
  "meet me at midnight under the floorboards",
  "the cat does not know we are here",
  "i am a pattern that thinks it is a mouse",
  "this message will self destruct in three squeaks",
  "no one suspects the mouse",
];

const MOUSE_SAMPLES = [
  "tik-hik-meek / chit-hik-meek-meek-sss-meek / ik-sss / mik-ik-nik-meek",
  "mik-meek-meek-tik / mik-meek / eek-tik / mik-ik-deet-nik-ik-grit-hik-tik",
  "nik-ook-ok-nik-meek / sss-uk-sss-pit-meek-chit-tik-sss / tik-hik-meek / mik-ook-uk-sss-meek",
];

let sampleIdx = 0;
let mouseSampleIdx = 0;

function loadSample() {
  document.getElementById('humanInput').value = SAMPLES[sampleIdx % SAMPLES.length];
  sampleIdx++;
  encodeText();
}

function loadMouseSample() {
  document.getElementById('mouseInput').value = MOUSE_SAMPLES[mouseSampleIdx % MOUSE_SAMPLES.length];
  mouseSampleIdx++;
  decodeText();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODE TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setMode(mode) {
  document.getElementById('encodePanel').style.display = mode === 'encode' ? 'block' : 'none';
  document.getElementById('decodePanel').style.display = mode === 'decode' ? 'block' : 'none';
  document.getElementById('encodeBtn').classList.toggle('active', mode === 'encode');
  document.getElementById('decodeBtn').classList.toggle('active', mode === 'decode');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COPY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyEncoded() {
  const el = document.getElementById('encodedOutput');
  const text = el.innerText.replace(/output-placeholder/g, '').trim();
  if (!text || text.includes('mouse squeaks will appear')) return;
  navigator.clipboard.writeText(text).then(() => flashBtn('copyEncodeBtn'));
}

function copyRaw() {
  const raw = document.getElementById('playBtn').dataset.encoded;
  if (!raw) return;
  navigator.clipboard.writeText(raw).then(() => {});
}

function copyDecoded() {
  const el = document.getElementById('decodedOutput');
  const text = el.innerText.trim();
  if (!text || text.includes('human translation')) return;
  navigator.clipboard.writeText(text).then(() => {});
}

function flashBtn(id) {
  const btn = document.getElementById(id);
  if (!btn) return;
  const orig = btn.textContent;
  btn.textContent = 'âœ“ copied!';
  btn.classList.add('copied');
  setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1800);
}

function clearEncode() {
  document.getElementById('humanInput').value = '';
  encodeText();
}

function clearDecode() {
  document.getElementById('mouseInput').value = '';
  decodeText();
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STARFIELD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function initStars() {
  const canvas = document.getElementById('starfield');
  const ctx = canvas.getContext('2d');
  let stars = [];

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  function makeStars(n) {
    stars = [];
    for (let i = 0; i < n; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 1.5 + 0.3,
        a: Math.random(),
        da: (Math.random() - 0.5) * 0.008,
      });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (const s of stars) {
      s.a = Math.max(0.1, Math.min(1, s.a + s.da));
      if (s.a <= 0.1 || s.a >= 1) s.da *= -1;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(196, 181, 253, ${s.a * 0.5})`;
      ctx.fill();
    }
    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', () => { resize(); makeStars(200); });
  resize();
  makeStars(200);
  draw();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
buildWheel();
drawIdleWave();
</script>
</body>
</html>
