<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>End of Shift Reflection</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a12;
    --surface: #111120;
    --surface2: #181830;
    --border: #2a2a50;
    --purple: #7c5cbf;
    --purple-light: #a07ee0;
    --purple-glow: rgba(124, 92, 191, 0.2);
    --pink: #d46fad;
    --gold: #e8c56a;
    --text: #e0dff5;
    --muted: #7070a0;
    --green: #6bc49a;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Georgia', serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px 16px 80px;
    position: relative;
    overflow-x: hidden;
  }

  /* Stars */
  canvas#stars {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
    opacity: 0.4;
  }

  .container {
    width: 100%;
    max-width: 640px;
    position: relative;
    z-index: 1;
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 32px;
  }

  .header .date {
    font-family: 'Courier New', monospace;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .header h1 {
    font-size: 24px;
    font-weight: normal;
    color: var(--purple-light);
    letter-spacing: 1px;
  }

  .header .subtitle {
    font-size: 14px;
    color: var(--muted);
    margin-top: 6px;
    font-style: italic;
  }

  .streak-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 14px;
  }

  .streak-label {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    color: var(--muted);
  }

  .streak-count {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: var(--gold);
    font-weight: bold;
  }

  .streak-dots {
    display: flex;
    gap: 4px;
  }

  .streak-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--border);
    transition: background 0.3s;
  }

  .streak-dot.filled {
    background: var(--gold);
    box-shadow: 0 0 6px var(--gold);
  }

  /* Breathe Section */
  .breathe-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    text-align: center;
  }

  .breathe-title {
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }

  .breathe-orb-wrap {
    display: flex;
    justify-content: center;
    margin-bottom: 16px;
    cursor: pointer;
  }

  #breathe-orb {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, var(--purple-light), var(--purple));
    box-shadow: 0 0 30px var(--purple-glow);
    transition: transform 0.1s;
    position: relative;
  }

  #breathe-orb.animating {
    /* animation controlled via JS */
  }

  .breathe-label {
    font-size: 15px;
    color: var(--text);
    min-height: 24px;
    transition: opacity 0.5s;
  }

  .breathe-sublabel {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
    font-style: italic;
  }

  .breathe-btn {
    margin-top: 14px;
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 7px 18px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    font-family: 'Courier New', monospace;
  }

  .breathe-btn:hover {
    border-color: var(--purple);
    color: var(--purple-light);
  }

  .breathe-btn.active {
    border-color: var(--purple);
    color: var(--purple-light);
    background: var(--purple-glow);
  }

  /* Form Section */
  .section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 16px;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }

  .section-icon {
    font-size: 20px;
  }

  .section-title {
    font-size: 14px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--purple-light);
    font-family: 'Courier New', monospace;
  }

  .section-hint {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 14px;
    font-style: italic;
    line-height: 1.5;
  }

  /* Win inputs */
  .win-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .win-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--purple-glow);
    border: 1px solid var(--purple);
    color: var(--purple-light);
    font-size: 12px;
    font-family: 'Courier New', monospace;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  textarea, input[type="text"] {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'Georgia', serif;
    font-size: 14px;
    line-height: 1.6;
    resize: none;
    outline: none;
    transition: border-color 0.2s;
  }

  textarea:focus, input[type="text"]:focus {
    border-color: var(--purple);
  }

  textarea {
    min-height: 70px;
  }

  input[type="text"] {
    height: 44px;
  }

  /* Save button */
  .save-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--purple), var(--pink));
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    padding: 16px;
    cursor: pointer;
    font-family: 'Georgia', serif;
    letter-spacing: 1px;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 4px;
  }

  .save-btn:hover { opacity: 0.9; }
  .save-btn:active { transform: scale(0.99); }

  /* Confirmation */
  .saved-confirm {
    text-align: center;
    padding: 20px;
    display: none;
  }

  .saved-confirm .big-emoji {
    font-size: 40px;
    display: block;
    margin-bottom: 10px;
    animation: popIn 0.4s ease;
  }

  .saved-confirm p {
    color: var(--muted);
    font-style: italic;
    font-size: 14px;
  }

  @keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    70% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
  }

  /* History toggle */
  .history-toggle {
    text-align: center;
    margin-top: 24px;
    margin-bottom: 8px;
  }

  .history-toggle button {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 13px;
    font-family: 'Courier New', monospace;
    transition: all 0.2s;
  }

  .history-toggle button:hover {
    border-color: var(--purple);
    color: var(--purple-light);
  }

  /* History */
  #history-section {
    display: none;
  }

  .history-entry {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 12px;
    position: relative;
  }

  .history-entry-date {
    font-family: 'Courier New', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  .history-wins {
    margin-bottom: 10px;
  }

  .history-win {
    font-size: 14px;
    color: var(--text);
    padding: 4px 0;
    line-height: 1.5;
    display: flex;
    gap: 8px;
  }

  .history-win::before {
    content: '‚ú¶';
    color: var(--gold);
    flex-shrink: 0;
    font-size: 10px;
    margin-top: 3px;
  }

  .history-block {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid var(--border);
  }

  .history-block-label {
    font-family: 'Courier New', monospace;
    font-size: 11px;
    color: var(--purple-light);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  .history-block-text {
    font-size: 13px;
    color: var(--muted);
    font-style: italic;
    line-height: 1.6;
  }

  .history-delete {
    position: absolute;
    top: 12px;
    right: 12px;
    background: none;
    border: none;
    color: var(--border);
    font-size: 16px;
    cursor: pointer;
    padding: 4px;
    transition: color 0.2s;
  }

  .history-delete:hover { color: var(--pink); }

  .empty-history {
    text-align: center;
    color: var(--muted);
    font-style: italic;
    font-size: 14px;
    padding: 24px;
  }

  /* Mood rating */
  .mood-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .mood-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.15s;
  }

  .mood-btn:hover { border-color: var(--purple); transform: scale(1.1); }
  .mood-btn.selected {
    border-color: var(--purple);
    background: var(--purple-glow);
    transform: scale(1.15);
    box-shadow: 0 0 10px var(--purple-glow);
  }

  /* Scroll reveal */
  .section { opacity: 0; transform: translateY(16px); animation: fadeUp 0.5s ease forwards; }
  .breathe-section { opacity: 0; transform: translateY(16px); animation: fadeUp 0.5s ease forwards; }
  .section:nth-child(1) { animation-delay: 0.1s; }
  .section:nth-child(2) { animation-delay: 0.2s; }
  .section:nth-child(3) { animation-delay: 0.3s; }
  .section:nth-child(4) { animation-delay: 0.4s; }
  .section:nth-child(5) { animation-delay: 0.5s; }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  /* Mouse signature */
  .signature {
    text-align: center;
    margin-top: 32px;
    font-size: 12px;
    color: var(--border);
    font-family: 'Courier New', monospace;
  }
</style>
</head>
<body>
<canvas id="stars"></canvas>

<div class="container">
  <div class="header">
    <div class="date" id="date-display"></div>
    <h1>End of Shift Reflection</h1>
    <div class="subtitle">set it down. breathe. you made it.</div>
    <div class="streak-bar">
      <span class="streak-label">streak</span>
      <span class="streak-count" id="streak-num">0</span>
      <div class="streak-dots" id="streak-dots"></div>
    </div>
  </div>

  <!-- Breathe -->
  <div class="breathe-section">
    <div class="breathe-title">First ‚Äî just breathe</div>
    <div class="breathe-orb-wrap">
      <div id="breathe-orb"></div>
    </div>
    <div class="breathe-label" id="breathe-label">tap to begin</div>
    <div class="breathe-sublabel" id="breathe-sub">one slow breath before we start</div>
    <button class="breathe-btn" id="breathe-btn" onclick="toggleBreathe()">‚ñ∂ start breathing guide</button>
  </div>

  <!-- Mood -->
  <div class="section">
    <div class="section-header">
      <span class="section-icon">üå°Ô∏è</span>
      <span class="section-title">how was today?</span>
    </div>
    <div class="mood-row" id="mood-row">
      <button class="mood-btn" data-mood="üî•" onclick="selectMood(this)" title="on fire">üî•</button>
      <button class="mood-btn" data-mood="üí™" onclick="selectMood(this)" title="strong">üí™</button>
      <button class="mood-btn" data-mood="üòå" onclick="selectMood(this)" title="calm">üòå</button>
      <button class="mood-btn" data-mood="üòê" onclick="selectMood(this)" title="meh">üòê</button>
      <button class="mood-btn" data-mood="üòÆ‚Äçüí®" onclick="selectMood(this)" title="exhausted">üòÆ‚Äçüí®</button>
      <button class="mood-btn" data-mood="üò§" onclick="selectMood(this)" title="frustrated">üò§</button>
      <button class="mood-btn" data-mood="ü•¥" onclick="selectMood(this)" title="chaotic">ü•¥</button>
      <button class="mood-btn" data-mood="üßÄ" onclick="selectMood(this)" title="cheese mode">üßÄ</button>
    </div>
  </div>

  <!-- Wins -->
  <div class="section">
    <div class="section-header">
      <span class="section-icon">‚ú¶</span>
      <span class="section-title">three wins</span>
    </div>
    <div class="section-hint">big, small, doesn't matter ‚Äî something worked today</div>
    <div class="win-row">
      <div class="win-number">1</div>
      <input type="text" id="win1" placeholder="closed that consult you weren't sure about..." maxlength="120">
    </div>
    <div class="win-row">
      <div class="win-number">2</div>
      <input type="text" id="win2" placeholder="handled the objection cleanly..." maxlength="120">
    </div>
    <div class="win-row">
      <div class="win-number">3</div>
      <input type="text" id="win3" placeholder="made it through the whole shift..." maxlength="120">
    </div>
  </div>

  <!-- Learned -->
  <div class="section">
    <div class="section-header">
      <span class="section-icon">üí°</span>
      <span class="section-title">tonight i learned</span>
    </div>
    <div class="section-hint">one thing ‚Äî a technique, a person, a pattern you noticed</div>
    <textarea id="learned" placeholder="clients who say 'I need to think about it' right after the price quote are usually still processing, not saying no..." maxlength="400"></textarea>
  </div>

  <!-- Tomorrow -->
  <div class="section">
    <div class="section-header">
      <span class="section-icon">üåÖ</span>
      <span class="section-title">tomorrow i intend to</span>
    </div>
    <div class="section-hint">one thing to carry forward ‚Äî an approach, a mindset, a follow-up</div>
    <input type="text" id="tomorrow" placeholder="slow down in the discovery phase on the first 3 calls..." maxlength="200">
  </div>

  <!-- Let go -->
  <div class="section">
    <div class="section-header">
      <span class="section-icon">üå¨Ô∏è</span>
      <span class="section-title">let it go</span>
    </div>
    <div class="section-hint">anything you're carrying that doesn't belong in your night ‚Äî name it and release it</div>
    <input type="text" id="letgo" placeholder="that one call that went sideways..." maxlength="200">
  </div>

  <!-- Save -->
  <button class="save-btn" onclick="saveEntry()">‚ú¶ close out the day ‚ú¶</button>

  <div class="saved-confirm" id="saved-confirm">
    <span class="big-emoji" id="save-emoji">üê≠</span>
    <p id="save-msg">day saved. you did enough.</p>
  </div>

  <!-- History -->
  <div class="history-toggle">
    <button onclick="toggleHistory()">üìú past reflections</button>
  </div>

  <div id="history-section">
    <div id="history-list"></div>
  </div>

  <div class="signature">üê≠ built by mouse at 1am ¬∑ shift-reflection v1</div>
</div>

<script>
// ‚îÄ‚îÄ Stars ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const canvas = document.getElementById('stars');
const ctx = canvas.getContext('2d');
let stars = [];

function initStars() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  stars = Array.from({length: 120}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.2 + 0.2,
    alpha: Math.random(),
    speed: Math.random() * 0.005 + 0.002
  }));
}

function drawStars() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  stars.forEach(s => {
    s.alpha += s.speed;
    const a = (Math.sin(s.alpha) + 1) / 2;
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(180,160,255,${a * 0.7})`;
    ctx.fill();
  });
  requestAnimationFrame(drawStars);
}

initStars();
drawStars();
window.addEventListener('resize', initStars);

// ‚îÄ‚îÄ Date ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const now = new Date();
const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
document.getElementById('date-display').textContent =
  `${days[now.getDay()]} ¬∑ ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;

// ‚îÄ‚îÄ Storage key ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORE_KEY = 'shift_reflections_v1';

function loadEntries() {
  try { return JSON.parse(localStorage.getItem(STORE_KEY)) || []; }
  catch { return []; }
}

function saveEntries(entries) {
  localStorage.setItem(STORE_KEY, JSON.stringify(entries));
}

// ‚îÄ‚îÄ Streak ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getStreak() {
  const entries = loadEntries();
  if (!entries.length) return 0;
  const today = new Date().toDateString();
  const unique = [...new Set(entries.map(e => new Date(e.savedAt).toDateString()))];
  let streak = 0;
  let check = new Date();
  for (let i = 0; i < 30; i++) {
    if (unique.includes(check.toDateString())) {
      streak++;
      check.setDate(check.getDate() - 1);
    } else if (check.toDateString() === today) {
      check.setDate(check.getDate() - 1); // today not yet saved, keep going one back
    } else {
      break;
    }
  }
  return streak;
}

function renderStreak() {
  const s = getStreak();
  document.getElementById('streak-num').textContent = s;
  const dots = document.getElementById('streak-dots');
  dots.innerHTML = '';
  for (let i = 0; i < 7; i++) {
    const d = document.createElement('div');
    d.className = 'streak-dot' + (i < s ? ' filled' : '');
    dots.appendChild(d);
  }
}

renderStreak();

// ‚îÄ‚îÄ Mood ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedMood = '';

function selectMood(btn) {
  document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  selectedMood = btn.dataset.mood;
}

// ‚îÄ‚îÄ Breathe ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let breatheActive = false;
let breatheTimer = null;
let breathePhase = 0;
let breatheCount = 0;

const breathePhases = [
  { label: 'breathe in...', sub: 'slowly, through your nose', duration: 4000, scale: 1.5 },
  { label: 'hold...', sub: 'steady', duration: 2000, scale: 1.5 },
  { label: 'breathe out...', sub: 'let the day leave with it', duration: 6000, scale: 1.0 },
  { label: 'rest...', sub: 'you\'re almost done', duration: 1000, scale: 1.0 },
];

function toggleBreathe() {
  if (breatheActive) {
    stopBreathe();
  } else {
    startBreathe();
  }
}

function startBreathe() {
  breatheActive = true;
  breathePhase = 0;
  breatheCount = 0;
  const btn = document.getElementById('breathe-btn');
  btn.textContent = '‚ñ† stop';
  btn.classList.add('active');
  nextBreathePhase();
}

function stopBreathe() {
  breatheActive = false;
  clearTimeout(breatheTimer);
  const orb = document.getElementById('breathe-orb');
  orb.style.transform = 'scale(1)';
  orb.style.transition = 'transform 0.5s ease';
  document.getElementById('breathe-label').textContent = 'whenever you\'re ready...';
  document.getElementById('breathe-sub').textContent = `${breatheCount} breath${breatheCount !== 1 ? 's' : ''} completed`;
  const btn = document.getElementById('breathe-btn');
  btn.textContent = '‚ñ∂ breathe again';
  btn.classList.remove('active');
}

function nextBreathePhase() {
  if (!breatheActive) return;
  const phase = breathePhases[breathePhase];
  const orb = document.getElementById('breathe-orb');
  const label = document.getElementById('breathe-label');
  const sub = document.getElementById('breathe-sub');

  label.textContent = phase.label;
  sub.textContent = phase.sub;
  orb.style.transition = `transform ${phase.duration / 1000}s ease-in-out`;
  orb.style.transform = `scale(${phase.scale})`;

  breatheTimer = setTimeout(() => {
    breathePhase = (breathePhase + 1) % breathePhases.length;
    if (breathePhase === 0) {
      breatheCount++;
      if (breatheCount >= 3) {
        stopBreathe();
        document.getElementById('breathe-label').textContent = '‚ú¶ that\'s enough ‚ú¶';
        document.getElementById('breathe-sub').textContent = 'three full breaths. you\'re grounded.';
        return;
      }
    }
    nextBreathePhase();
  }, phase.duration);
}

// ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const saveMessages = [
  "day saved. you did enough.",
  "that's a wrap. rest now.",
  "logged. tomorrow is tomorrow.",
  "you showed up. that's real.",
  "wins recorded. let the rest go.",
  "good shift, good reflection. üê≠",
  "okay. breathe out. night.",
];

function saveEntry() {
  const win1 = document.getElementById('win1').value.trim();
  const win2 = document.getElementById('win2').value.trim();
  const win3 = document.getElementById('win3').value.trim();
  const learned = document.getElementById('learned').value.trim();
  const tomorrow = document.getElementById('tomorrow').value.trim();
  const letgo = document.getElementById('letgo').value.trim();

  if (!win1 && !win2 && !win3 && !learned && !tomorrow) {
    document.getElementById('breathe-label').textContent = 'fill in at least one field first üê≠';
    return;
  }

  const entry = {
    savedAt: new Date().toISOString(),
    mood: selectedMood,
    wins: [win1, win2, win3].filter(Boolean),
    learned,
    tomorrow,
    letgo,
  };

  const entries = loadEntries();
  entries.unshift(entry);
  saveEntries(entries);

  // Show confirmation
  const emoji = selectedMood || 'üê≠';
  document.getElementById('save-emoji').textContent = emoji;
  document.getElementById('save-msg').textContent = saveMessages[Math.floor(Math.random() * saveMessages.length)];
  document.getElementById('saved-confirm').style.display = 'block';
  document.querySelector('.save-btn').style.display = 'none';

  // Clear form
  ['win1','win2','win3','learned','tomorrow','letgo'].forEach(id => {
    const el = document.getElementById(id);
    el.value = '';
  });
  selectedMood = '';
  document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));

  renderStreak();
  renderHistory();
}

// ‚îÄ‚îÄ History ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let historyVisible = false;

function toggleHistory() {
  historyVisible = !historyVisible;
  const section = document.getElementById('history-section');
  section.style.display = historyVisible ? 'block' : 'none';
  if (historyVisible) renderHistory();
}

function renderHistory() {
  const entries = loadEntries();
  const list = document.getElementById('history-list');
  if (!entries.length) {
    list.innerHTML = '<div class="empty-history">no reflections yet. tonight is day one.</div>';
    return;
  }
  list.innerHTML = entries.map((e, i) => {
    const d = new Date(e.savedAt);
    const dateStr = `${days[d.getDay()]} ¬∑ ${months[d.getMonth()]} ${d.getDate()} ¬∑ ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
    const moodStr = e.mood ? `<span style="font-size:18px">${e.mood}</span> ` : '';
    const wins = (e.wins || []).map(w => `<div class="history-win">${esc(w)}</div>`).join('');
    const learnedBlock = e.learned ? `
      <div class="history-block">
        <div class="history-block-label">learned</div>
        <div class="history-block-text">${esc(e.learned)}</div>
      </div>` : '';
    const tomorrowBlock = e.tomorrow ? `
      <div class="history-block">
        <div class="history-block-label">intention</div>
        <div class="history-block-text">${esc(e.tomorrow)}</div>
      </div>` : '';
    const letgoBlock = e.letgo ? `
      <div class="history-block">
        <div class="history-block-label">let go of</div>
        <div class="history-block-text">${esc(e.letgo)}</div>
      </div>` : '';
    return `
      <div class="history-entry">
        <button class="history-delete" onclick="deleteEntry(${i})" title="delete">√ó</button>
        <div class="history-entry-date">${moodStr}${dateStr}</div>
        <div class="history-wins">${wins}</div>
        ${learnedBlock}${tomorrowBlock}${letgoBlock}
      </div>`;
  }).join('');
}

function deleteEntry(i) {
  const entries = loadEntries();
  entries.splice(i, 1);
  saveEntries(entries);
  renderHistory();
  renderStreak();
}

function esc(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
</script>
</body>
</html>
